<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THAT'S NOT THE GAME</title>
<style>
html,body{
  margin:0; padding:0;
  background:black;
  overflow:hidden;
  font-family:'Courier New',monospace;
  color:#00bfff;
  height:100%;
}
#gameCanvas{
  position:absolute;
  width:100%;
  height:100%;
  top:0; left:0;
  background:radial-gradient(circle at center,#000010 0%,#000 100%);
}
.center{
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
  color:#00bfff;
  text-shadow:0 0 10px #00ffff,0 0 20px #0088ff;
  font-size:2em;
}
.glitch{
  animation:glitchFlash 0.1s infinite alternate;
}
@keyframes glitchFlash{
  from{opacity:1;transform:translate(0,0);}
  to{opacity:0.2;transform:translate(2px,-2px);}
}
.fadeOut{animation:fadeOut 1s forwards;}
@keyframes fadeOut{to{opacity:0;}}
.fadeIn{animation:fadeIn 1s forwards;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
.hidden{display:none;}
button{
  background:transparent;
  border:1px solid #00bfff;
  color:#00bfff;
  padding:10px 20px;
  font-size:1em;
  cursor:pointer;
}
button:hover{background:#00bfff;color:black;}
</style>
</head>
<body>
<div id="intro" class="center glitch">THAT'S NOT THE GAME</div>
<canvas id="gameCanvas" class="hidden"></canvas>
<div id="ui" class="center hidden">
  <div id="message"></div>
  <button id="nextBtn" class="hidden">Next</button>
  <button id="restartBtn" class="hidden">Restart Game</button>
</div>
<audio id="music" loop preload="auto"
 src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_c3db425cd5.mp3?filename=trap-royalty-110094.mp3"></audio>
<script>
const intro=document.getElementById('intro');
const canvas=document.getElementById('gameCanvas');
const ui=document.getElementById('ui');
const msg=document.getElementById('message');
const nextBtn=document.getElementById('nextBtn');
const restartBtn=document.getElementById('restartBtn');
const ctx=canvas.getContext('2d');
let level=0;
let playing=false;
let music=document.getElementById('music');

function startGame(){
  intro.classList.add('fadeOut');
  setTimeout(()=>{
    intro.classList.add('hidden');
    canvas.classList.remove('hidden');
    ui.classList.remove('hidden');
    nextLevel();
  },1000);
}

intro.addEventListener('click',startGame);

function clearCanvas(){
  ctx.fillStyle='black';
  ctx.fillRect(0,0,canvas.width,canvas.height);
}
function resizeCanvas(){
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

function nextLevel(){
  level++;
  msg.innerHTML='';
  nextBtn.classList.add('hidden');
  clearCanvas();
  switch(level){
    case 1: invisibleClick(); break;
    case 2: errorChase(); break;
    case 3: dimensionHop(); break;
    case 4: rhythmDuel(); break;
    case 5: mirrorReality(); break;
    default: ending(); break;
  }
}

/* --- LEVEL 1: INVISIBLE CLICK --- */
function invisibleClick(){
  msg.textContent='Find the hidden button...';
  let btnX=Math.random()*canvas.width;
  let btnY=Math.random()*canvas.height;
  canvas.onclick=(e)=>{
    let dx=e.clientX-btnX,dy=e.clientY-btnY;
    if(Math.abs(dx)<50&&Math.abs(dy)<30){
      canvas.onclick=null;
      msg.textContent='You found it.';
      nextBtn.classList.remove('hidden');
    }
  };
}
nextBtn.onclick=()=>nextLevel();

/* --- LEVEL 2: ERROR CHASE --- */
function errorChase(){
  msg.textContent='Catch the 404 before it escapes!';
  let x=100,y=100,dx=5,dy=3;
  function drawBox(){
    clearCanvas();
    ctx.fillStyle='#00bfff';
    ctx.fillRect(x,y,80,40);
    ctx.fillStyle='black';
    ctx.fillText('404',x+25,y+25);
  }
  let interval=setInterval(()=>{
    x+=dx; y+=dy;
    if(x<0||x>canvas.width-80)dx*=-1;
    if(y<0||y>canvas.height-40)dy*=-1;
    drawBox();
  },30);
  canvas.onclick=(e)=>{
    if(e.clientX>=x&&e.clientX<=x+80&&e.clientY>=y&&e.clientY<=y+40){
      clearInterval(interval);
      canvas.onclick=null;
      msg.textContent='Caught it!';
      nextBtn.classList.remove('hidden');
    }
  };
}

/* --- LEVEL 3: DIMENSION HOP --- */
function dimensionHop(){
  msg.textContent='Drag the pieces to fix the screen.';
  let pieces=[{x:50,y:50,tx:100,ty:100},
              {x:200,y:150,tx:300,ty:150},
              {x:400,y:300,tx:500,ty:300}];
  let held=null,offX=0,offY=0;
  function draw(){
    clearCanvas();
    ctx.strokeStyle='#00bfff';
    pieces.forEach(p=>ctx.strokeRect(p.x,p.y,80,80));
  }
  canvas.onmousedown=(e)=>{
    pieces.forEach(p=>{
      if(e.clientX>p.x&&e.clientX<p.x+80&&e.clientY>p.y&&e.clientY<p.y+80){
        held=p; offX=e.clientX-p.x; offY=e.clientY-p.y;
      }
    });
  };
  canvas.onmousemove=(e)=>{if(held){held.x=e.clientX-offX;held.y=e.clientY-offY;draw();}};
  canvas.onmouseup=()=>{
    if(held){
      if(Math.abs(held.x-held.tx)<30&&Math.abs(held.y-held.ty)<30){
        held.x=held.tx;held.y=held.ty;
      }
      held=null;
      if(pieces.every(p=>Math.abs(p.x-p.tx)<5&&Math.abs(p.y-p.ty)<5)){
        canvas.onmousedown=null;
        canvas.onmousemove=null;
        canvas.onmouseup=null;
        msg.textContent='Dimension restored.';
        nextBtn.classList.remove('hidden');
      }
    }
  };
  draw();
}

/* --- LEVEL 4: RHYTHM DUEL --- */
function rhythmDuel(){
  msg.textContent='Press the arrows in rhythm!';
  if(!playing){music.play(); playing=true;}
  const keys=['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'];
  let sequence=[],index=0;
  for(let i=0;i<5;i++)sequence.push(keys[Math.floor(Math.random()*4)]);
  document.onkeydown=(e)=>{
    if(e.key===sequence[index]){
      index++;
      if(index>=sequence.length){
        document.onkeydown=null;
        msg.textContent='Error defeated.';
        nextBtn.classList.remove('hidden');
      }
    }
  };
  clearCanvas();
  ctx.fillStyle='#00bfff';
  ctx.fillText('Follow this pattern:',50,50);
  sequence.forEach((k,i)=>ctx.fillText(k,100+i*100,100));
}

/* --- LEVEL 5: MIRROR REALITY --- */
function mirrorReality(){
  msg.textContent='Everything reversed. Find the real EXIT.';
  let buttons=['EXIT','TXEI','EIXT','EXiT'];
  let correct=buttons[Math.floor(Math.random()*buttons.length)];
  buttons.sort(()=>Math.random()-0.5);
  let html='';
  buttons.forEach(b=>{html+=`<button class='mirrorBtn'>${b}</button><br>`;});
  msg.innerHTML=html;
  document.querySelectorAll('.mirrorBtn').forEach(btn=>{
    btn.onclick=()=>{
      if(btn.textContent===correct){
        msg.textContent='Reality restored.';
        nextBtn.classList.remove('hidden');
      } else {
        msg.textContent='Wrong exit... Try again.';
      }
    };
  });
}

/* --- ENDING --- */
function ending(){
  msg.textContent='You were the bug all along.';
  restartBtn.classList.remove('hidden');
  nextBtn.classList.add('hidden');
  music.pause();
}
restartBtn.onclick=()=>{
  level=0; playing=false;
  music.currentTime=0;
  music.pause();
  restartBtn.classList.add('hidden');
  nextLevel();
};
</script>
</body>
</html>
